#!/bin/bash

./wait-for ${RABBITMQ_HOST}:${RABBITMQ_PORT} -t 0
./wait-for ${BACKEND_SUPERVISOR_HOST}:${BACKEND_SUPERVISOR_PORT} -t 0

python executor.py 10000

curl -H "Authorization: token ${GITHUB_TOKEN}" -X POST \
    -d "{\"body\": \":tada: *Benchmark Results* :tada:\nBGP updates inserted (updates/sec): *$(cat bgp-update)*\nHijacks detected/inserted (hijacks/sec): *$(cat hijack-update)*\"}" \
    "https://api.github.com/repos/${SEMAPHORE_REPO_SLUG}/issues/${PULL_REQUEST_NUMBER}/comments"
