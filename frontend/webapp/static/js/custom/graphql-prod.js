var db_stats_query="{ Total_BGP_Updates: view_bgpupdates_aggregate { aggregate { count } } Total_Unhandled_Updates: view_bgpupdates_aggregate(where: {handled: {_eq: false}}) { aggregate { count } } Total_Hijacks: view_hijacks_aggregate { aggregate { count } } Resolved_Hijacks: view_hijacks_aggregate(where: {resolved: {_eq: true}}) { aggregate { count } } Mitigation_Hijacks: view_hijacks_aggregate(where: {under_mitigation: {_eq: true}}) { aggregate { count } } Ongoing_Hijacks: view_hijacks_aggregate(where: {active: {_eq: true}}) { aggregate { count } } Ignored_Hijacks: view_hijacks_aggregate(where: {ignored: {_eq: true}}) { aggregate { count } } Withdrawn_Hijacks: view_hijacks_aggregate(where: {withdrawn: {_eq: true}}) { aggregate { count } } Seen_Hijacks: view_hijacks_aggregate(where: {seen: {_eq: true}}) { aggregate { count } } Outdated_Hijacks: view_hijacks_aggregate(where: {outdated: {_eq: true}}) { aggregate { count } } }",
proc_stats_query="{ view_processes { name running timestamp } }",config_stats_query="{ view_configs(limit: 1, order_by: {time_modified: desc}) { raw_config comment time_modified } }";function waitForConnection(a,b){1===a.readyState?a.send(b):setTimeout(function(){return waitForConnection(a,b)},1E3)}var dbstatsCalled=!1;
function fetchDbStatsLive(a,b){dbstatsCalled&&waitForConnection(a,JSON.stringify({id:"1",type:"stop"}));waitForConnection(a,JSON.stringify({id:"1",type:"start",payload:{variables:{},extensions:{},operationName:"getLiveStats",query:"subscription getLiveStats "+db_stats_query}}));dbstatsCalled||(a.addEventListener("message",function(a){data=JSON.parse(a.data);"data"===data.type&&"1"===data.id&&b(data.payload.data)}),dbstatsCalled=!0)}var datatableCalled=!1;
function stopDatatableLive(a){waitForConnection(a,JSON.stringify({id:"2",type:"stop"}))}function startDatatableLive(a,b){waitForConnection(a,JSON.stringify({id:"2",type:"start",payload:{variables:{},extensions:{},operationName:"getLiveTable",query:"subscription getLiveTable "+b}}))}
function fetchDatatableLive(a,b,c){datatableCalled&&waitForConnection(a,JSON.stringify({id:"2",type:"stop"}));waitForConnection(a,JSON.stringify({id:"2",type:"start",payload:{variables:{},extensions:{},operationName:"getLiveTable",query:"subscription getLiveTable "+c}}));datatableCalled||(a.addEventListener("message",function(a){data=JSON.parse(a.data);"data"===data.type&&"2"===data.id&&(b({recordsTotal:data.payload.data.datatable.aggregate.totalCount,recordsFiltered:data.payload.data.datatable.aggregate.totalCount,
data:format_datatable(data.payload.data.view_data)}),$(".tooltip").tooltip("hide"))}),datatableCalled=!0)}
function fetchDatatable(a,b){fetch("/jwt/auth",{method:"GET"}).then(function(a){return a.json()}).then(function(c){fetch("/api/graphql",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:"Bearer "+c.access_token},body:JSON.stringify({query:"query getTable "+b})}).then(function(a){return a.json()}).then(function(b){a({recordsTotal:b.data.datatable.aggregate.totalCount,recordsFiltered:b.data.datatable.aggregate.totalCount,data:format_datatable(b.data.view_data)})}).catch(function(a){return console.error(a)})}).catch(function(a){return console.error(a)})}
function fetchDistinctValues(a,b){fetch("/jwt/auth",{method:"GET"}).then(function(a){return a.json()}).then(function(c){fetch("/api/graphql",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:"Bearer "+c.access_token},body:JSON.stringify({query:"query getDistinctValues "+b})}).then(function(a){return a.json()}).then(function(b){var c=[];$(".tooltip").tooltip("hide");if("origin_as"==a||"peer_asn"==a||"hijack_as"==a){for(var d in b.data.view_data)c.push("<cc_as>"+
b.data.view_data[d][a]+"</cc_as>");"<cc_as>-1</cc_as>"==c[0]&&c.shift();$("#distinct_values_text").html(c.join(", "));asn_map_to_name()}else if("service"==a){for(d in b.data.view_data)c.push(format_service(b.data.view_data[d][a]));$("#distinct_values_text").html(c.join(", "));service_to_name()}else{for(d in b.data.view_data)c.push(b.data.view_data[d][a]);$("#distinct_values_text").text(c.join(", "))}$("#distinct_values_text").show()}).catch(function(a){return console.error(a)})}).catch(function(a){return console.error(a)})}
var processStateCalled=!1;function fetchProcStatesLive(a,b){processStateCalled&&waitForConnection(a,JSON.stringify({id:"3",type:"stop"}));waitForConnection(a,JSON.stringify({id:"3",type:"start",payload:{variables:{},extensions:{},operationName:"getStates",query:"subscription getStates "+proc_stats_query}}));processStateCalled||(a.addEventListener("message",function(a){data=JSON.parse(a.data);"data"===data.type&&"3"===data.id&&b(data.payload.data)}),processStateCalled=!0)}var configStatsCalled=!1;
function fetchConfigStatsLive(a,b){configStatsCalled&&waitForConnection(a,JSON.stringify({id:"5",type:"stop"}));waitForConnection(a,JSON.stringify({id:"5",type:"start",payload:{variables:{},extensions:{},operationName:"getConfig",query:"subscription getConfig "+config_stats_query}}));configStatsCalled||(a.addEventListener("message",function(a){data=JSON.parse(a.data);"data"===data.type&&"5"===data.id&&b(data.payload.data)}),configStatsCalled=!0)};
